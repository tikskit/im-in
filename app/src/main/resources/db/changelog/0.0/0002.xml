<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd
  http://www.liquibase.org/xml/ns/pro
  http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.1.xsd">

    <changeSet id="0001" author="tikskit">
        <createTable tableName="countries" schemaName="places">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_countries"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints unique="true" uniqueConstraintName="c_name_unique"
                             nullable="false" notNullConstraintName="c_name_not_null"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="0002" author="tikskit">
        <createTable tableName="states" schemaName="places">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_states"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints unique="true" uniqueConstraintName="c_name_unique"
                             nullable="false" notNullConstraintName="c_name_not_null"/>
            </column>
            <column name="country_id" type="BIGINT">
                <constraints nullable="false" notNullConstraintName="c_country_id_not_null"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="0003" author="tikskit">
        <createIndex tableName="states" indexName="ix_country_id">
            <column name="country_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="0004" author="tikskit">
        <addForeignKeyConstraint baseTableName="states"
                                 baseColumnNames="country_id" constraintName="fk_states_countries"
                                 baseTableSchemaName="places"
                                 referencedTableName="countries" referencedColumnNames="id"
                                 referencedTableSchemaName="places"
                                 onUpdate="CASCADE" onDelete="CASCADE"/>
    </changeSet>

    <changeSet id="0005" author="tikskit">
        <createTable tableName="counties" schemaName="places">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_counties"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints unique="true" uniqueConstraintName="c_name_unique"
                             nullable="false" notNullConstraintName="c_name_not_null"/>
            </column>
            <column name="state_id" type="BIGINT">
                <constraints nullable="false" notNullConstraintName="c_state_id_not_null"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="0006" author="tikskit">
        <createIndex tableName="counties" indexName="ix_state_id">
            <column name="state_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="0007" author="tikskit">
        <addForeignKeyConstraint baseTableName="counties"
                                 baseColumnNames="state_id" constraintName="fk_counties_states"
                                 baseTableSchemaName="places"
                                 referencedTableName="states" referencedColumnNames="id"
                                 referencedTableSchemaName="places"
                                 onUpdate="CASCADE" onDelete="CASCADE"/>
    </changeSet>

    <changeSet id="0008" author="tikskit">
        <createTable tableName="cities" schemaName="places">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_cities"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints unique="true" uniqueConstraintName="c_name_unique"
                             nullable="false" notNullConstraintName="c_name_not_null"/>
            </column>
            <column name="county_id" type="BIGINT">
                <constraints nullable="false" notNullConstraintName="c_county_id_not_null"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="0009" author="tikskit">
        <createIndex tableName="cities" indexName="ix_county_id">
            <column name="county_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="0010" author="tikskit">
        <addForeignKeyConstraint baseTableName="cities"
                                 baseColumnNames="county_id" constraintName="fk_cities_counties"
                                 baseTableSchemaName="places"
                                 referencedTableName="counties" referencedColumnNames="id"
                                 referencedTableSchemaName="places"
                                 onUpdate="CASCADE" onDelete="CASCADE"/>
    </changeSet>

    <changeSet id="0011" author="tikskit">
        <createTable tableName="streets" schemaName="places">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_streets"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints unique="true" uniqueConstraintName="c_name_unique"
                             nullable="false" notNullConstraintName="c_name_not_null"/>
            </column>
            <column name="city_id" type="BIGINT">
                <constraints nullable="false" notNullConstraintName="c_city_id_not_null"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="0012" author="tikskit">
        <createIndex tableName="streets" indexName="ix_city_id">
            <column name="city_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="0013" author="tikskit">
        <addForeignKeyConstraint baseTableName="streets"
                                 baseColumnNames="city_id" constraintName="fk_streets_cities"
                                 baseTableSchemaName="places"
                                 referencedTableName="cities" referencedColumnNames="id"
                                 referencedTableSchemaName="places"
                                 onUpdate="CASCADE" onDelete="CASCADE"/>
    </changeSet>
</databaseChangeLog>